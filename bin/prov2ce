#!/usr/bin/python

from time import clock

print clock(), "\tImporting rdflib."
import rdflib
print clock(), "\tImporting provglish.transform."
from provglish import transform
print clock(), "\tImporting provglish.prov."
from provglish import prov

from sys import argv

graph = rdflib.graph.ConjunctiveGraph()
print clock(), "\tParsing input file:", argv[1]
graph.parse(argv[1],format="turtle", publicID="prov_graph")
print clock(), "\tLoading the PROV ontology."
prov.load_prov_ontology(graph)

print clock(), "\tInstantiating the transform engine."
tran = transform.Transformer()
tran.register_template(transform.definitions)
tran.register_template(transform.multi_prop)

print clock(), "\tGenerating all possible sentences."
sentences = tran.render_graph(graph)

print clock(), "\tRemoving duplicates."
sentences_pool = tran.remove_dup_coverage(sentences)

print clock(), "\tChoosing the right sentences."
chosen_sentences = tran.choose_sentences(sentences_pool)
            
print clock(), "\tWriting output to:", argv[2]            
output_file = open(argv[2], "w")
output_file.writelines([str(sentence)+"\n" for sentence in chosen_sentences])
output_file.flush()
output_file.close()
